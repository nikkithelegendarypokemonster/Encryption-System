#include <stdio.h>
#include <stdlib.h>
#include<conio.h>
int cur_end=0,start=0,min_burst=0,n=0,running=0,max_at=0,cur_start=0,flag=1;
int ready [200],qp=0,rp=0;
int queue[200];
typedef struct Proc
{
    int name;
    int AT,CPU1,S,E;
    int at[200],s[200],e[200];
    int ap,sp,ep;
    int complete;
} process[200],temporary;
process proc;
temporary temp;

int least_AT(int n)
{
    int min=proc[0].AT;
    for(int i=0; i<n; i++)
    {
        if(proc[i].AT<=min)
        {
            min=proc[i].AT;
        }
    }
    return min;
}
void sort(int s,int n){
    for(int i=s;i<n;i++){
        for(int k=s;k<n-1;k++){
            if(proc[k].AT>=proc[k+1].AT){
                    if(proc[k].AT==proc[k+1].AT){
                        if(proc[k+1].CPU1<proc[k].CPU1){
                            temp=proc[k];
                            proc[k]=proc[k+1];
                            proc[k+1]=temp;
                        }
                    }else{
                    temp=proc[k];
                    proc[k]=proc[k+1];
                    proc[k+1]=temp;
                    }

            }
        }
    }
    for(int i=0;i<n;i++){
      //  printf("P%d - ",proc[i].name);
    }
    printf("\n");
}
int least_BT(int start,int end,int n,int running){
    int min=proc[start].CPU1,loc=start;
    for(int i=0;i<n;i++){
        if(proc[i].CPU1<min && proc[i].AT>= start && proc[i].AT<=end && proc[i].CPU1>0){
            min=proc[i].CPU1;
            loc=i;
        }
    }
    return loc;
}
int inside_queue(int process){
   // printf("process:%d\n",ready[process]);
    for(int i=0;i<rp;i++){
        if(ready[i]==process){
            return 1;
        }
    }
    return 0;
}
void search(int n){
    for(int i=0;i<n;i++){
        if(inside_queue(i)==0){
            if(proc[i].AT>=start && proc[i].AT<=cur_end){
                // testing: printf("\ni:%d",i);
                ready[rp]=i;
                rp++;
            }
        }
    }
    printf("\n READY: ");
    for(int i=0;i<rp;i++){
        printf("%d - ",proc[ready[i]].name);
    }
    printf("\n");
}
int ultra_least(int n,int running){
int min=ready[running],big=0,big_loc=0;
if(proc[running].CPU1<=0){
    //find the bidggest bt in queue once you find one exit the loop
    for(int i=0;i<rp;i++){
        if(proc[ready[i]].CPU1>big){
        big=proc[ready[i]].CPU1;
        big_loc=i;
        break;
        }
    }
    printf("\nbig:%d\n",big_loc);
    min=big_loc;
}
//printf("proc[min].cpu:%d",proc[min].CPU1);
    for(int i=0;i<rp;i++){
        if(proc[i].CPU1< proc[min].CPU1 && proc[i].CPU1>0  ){
                min=i;
        }
    }
    //printf("\nfound min:%d",proc[min].name);
return min;
}
void srtf(int n){
int running=ready[0],least=0;
    while(cur_end<=max_at){
     least=ultra_least(n,running);
    printf("\nleast:P%d",proc[least].name);
    printf("\nrunning:P%d",proc[running].name);

    //KEEP RUNNING= CUREND+1 RUNNING.CPU-1 dont save end cause it will still run
    //INITIAL: curstart=0 curend=1
    if(((least==running) && proc[running].CPU1>0 )){
        if(flag==1){
            proc[running].S=cur_start;
            cur_end+=1;
            printf("cpu of running:%d\n",proc[running].CPU1);
             proc[running].s[proc[running].sp]=proc[running].S;
            proc[running].sp++;
        }else{
        cur_end+=1;
        proc[running].CPU1-=1;
        printf("cpu of running:%d\n",proc[running].CPU1);
        }

    }else{
        flag=0;
    //CONTEXT SWITCH
    //first  work the running process one more and set start
        printf("cpu of running:%d\n",proc[running].CPU1);
    //1->0,6->5,7->6
    //set the end of current running process to be terminated
    if(proc[running].CPU1<=proc[least].AT){
        proc[running].E=cur_end;
    }else{
    proc[running].E=proc[least].AT;
    }
    //set the start of the next process:least
    proc[least].S= cur_end;
    //proc
    //ends: p1->1,p1->
    proc[running].e[proc[running].ep]=proc[running].E;
    proc[running].ep++;
    proc[least].s[proc[least].sp]=proc[least].S;
    proc[least].sp++;
        running=least;
        cur_end+=1;
    }
    printf("\ncurstart:%d, cur_end:%d, running:%d\n",cur_start,cur_end,running);
    //work the running cpu
    proc[running].CPU1-=1;
    //========================
    search(n);
    }
    proc[running].E=cur_end;
    proc[running].e[proc[running].ep]=proc[running].E;
    proc[running].ep++;
}
int main()
{
    int i=0,total=0;
//get nth processes
    printf("sjf\n");
    printf("How many processes:");
    scanf("%d",&n);
    total=n;
// get inputs
    for(int i=0; i<n; i++)
    {
        printf("P%d:\n",i+1);
        proc[i].name=i+1;
        printf("AT:");
        scanf("%d",&proc[i].AT);
        printf("CPU1:");
        scanf("%d",&proc[i].CPU1);
        if(proc[i].AT>=max_at){
            max_at=proc[i].AT;
        }
    }

    sort(i,n);
    start=cur_start=proc[i].AT;
    cur_end=0;
    ready[0]=0;
    rp++;
    printf("ready[0]: P%d , ready[1]: P%d",proc[ready[0]].name,proc[ready[1]].name);
    proc[ready[0]].S=start;
    srtf(n);

for(int i=0;i<total;i++){
    printf("P%d\n",proc[i].name);
    printf("AT: ");
    for(int k=0;k<proc[i].ap;k++){
        printf("%d, ",proc[i].at[k]);
    }
    printf("\n");
    printf("CPU1: %d\n",proc[i].CPU1);
    printf("Start: ");
    for(int k=0;k<proc[i].sp;k++){
        printf("%d, ",proc[i].s[k]);
    }
    printf("\n");
    printf("End: ");
    for(int k=0;k<proc[i].ep;k++){
        printf("%d,",proc[i].e[k]);
    }
    printf("\n");
}

    return 0;
}
/*
5
2
1
1
5
4
1
0
6
2
3


6
0
7
1
5
2
3
3
1
4
2
5
1

5
0
1
2
3
2
1
3
3
4
1




            if(i!=running && proc[running].CPU1>0 &&(proc[i].AT>=start && proc[i].AT<=cur_end)){
                proc[running].CPU1=proc[running].CPU1-1;
                if(proc[running].CPU1<=0){
                    proc[running].S=cur_start;
                    proc[running].s[proc[running].sp]=proc[running].S;
                    proc[running].sp++;
                    proc[running].E=cur_end+(proc[running].CPU1+1);
                    proc[running].e[proc[running].ep]=proc[running].E;
                    proc[running].ep++;
                    cur_end=proc[running].E;
                    cur_start=cur_end;
                    last_run=running;
                    running=least_BT(start,cur_end,n);
                  printf("curtstart:%d\n",cur_start);
                    break;
                }
                if(proc[i].CPU1<proc[running].CPU1){
                  proc[running].S=cur_start;
                  proc[running].s[proc[running].sp]=proc[running].S;
                  proc[running].sp++;
                  if(proc[running].CPU1>proc[i].AT){
                    proc[running].E=proc[i].AT;
                    cur_end=proc[running].E;
                  }else{
                    proc[running].E=proc[running].CPU1;
                    cur_end=proc[running].E;
                  }
                      proc[running].e[proc[running].ep]=proc[running].E;
                        proc[running].ep++;
                        cur_start=cur_end;
                  running=i;
                  printf("curtstart:%d\n",cur_start);
                  break;
                }
            }














                            unit=unit-1;
                if(unit<=0){
                    proc[running].S=cur_start;
                    proc[running].s[proc[running].sp]=proc[running].S;
                    proc[running].sp++;
                    proc[running].E=cur_end+(proc[running].CPU1);
                    proc[running].e[proc[running].ep]=proc[running].E;
                    proc[running].ep++;
                    proc[running].CPU1=0;
                    cur_end=proc[running].E;
                    cur_start=cur_end;
                    running=least_BT(start,cur_end,n);
                  printf("curtstart:%d\n",cur_start);
                    break;
                }

                if(proc[i].CPU1<unit){
                  proc[running].S=cur_start;
                  proc[running].s[proc[running].sp]=proc[running].S;
                  proc[running].sp++;
                  if(proc[running].CPU1>proc[i].AT){
                    proc[running].E=proc[i].AT;
                    cur_end=proc[running].E;
                  }else{
                    proc[running].E=proc[running].CPU1;
                    cur_end=proc[running].E;
                  }

                      proc[running].e[proc[running].ep]=proc[running].E;
                        proc[running].ep++;
                        cur_start=cur_end;
                        last_run=running;
                  running=i;
                    if((unit)>proc[running].AT){
                    proc[running].CPU1-=unit;
                    }
                  printf("curtstart:%d\n",cur_start);
                  break;
                }
*/
